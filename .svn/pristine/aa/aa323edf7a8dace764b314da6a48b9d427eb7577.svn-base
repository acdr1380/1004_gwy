<!-- 选择单位抽屉 -->
<nz-drawer
    nzPlacement="right"
    [nzVisible]="unitSelectedIfy.visible"
    [nzWidth]="unitSelectedIfy.width"
    [nzTitle]="unitSelectedIfy.title"
    (nzOnClose)="unitSelectedIfy.close()"
>
    <div class="drawer_area">
        <div class="header">
            <button nz-button nzType="primary" (click)="evtAffirm()">确认选择</button>
            <nz-divider nzType="vertical"></nz-divider>
            <nz-button-group>
                <button nz-button nzSize="small" (click)="unitSelectedIfy.tree.evtChecklevel(true)">
                    选中下层
                </button>
                <button
                    nz-button
                    nzSize="small"
                    (click)="unitSelectedIfy.tree.evtChecklevel(false)"
                >
                    取消下层
                </button>
            </nz-button-group>
            <nz-divider nzType="vertical"></nz-divider>
            <!-- 搜索框 -->
            <nz-select
                nzShowSearch
                nzServerSearch
                nzAllowClear
                [ngStyle]="{ 'width.px': unitSelectedIfy.find.width || 200 }"
                [nzPlaceHolder]="unitSelectedIfy.find.placeholder || '请输入关键字搜索'"
                [nzShowArrow]="false"
                [nzFilterOption]="unitSelectedIfy.find.nzFilterOption"
                [(ngModel)]="unitSelectedIfy.find.value"
                (ngModelChange)="unitSelectedIfy.find.moduleChange($event)"
                (nzOnSearch)="unitSelectedIfy.find.onSearch($event)"
            >
                <ng-container *ngFor="let item of unitSelectedIfy.find.searchList">
                    <nz-option [nzLabel]="item.label" [nzValue]="item.value"> </nz-option>
                </ng-container>
            </nz-select>
        </div>

        <div class="container">
            <cdk-virtual-scroll-viewport #scrollViewport [itemSize]="32" class="view_scroll">
                <nz-tree
                    #unitSelectedIfyTree
                    nzAsyncData
                    nzCheckable
                    nzCheckStrictly
                    [nzData]="unitSelectedIfy.tree.nodes"
                    [nzTreeTemplate]="nzTreeRightTemplate"
                    (nzClick)="unitSelectedIfy.tree.evtActiveNode($event)"
                    [nzSelectedKeys]="unitSelectedIfy.tree.nzSelectedKeys"
                    (nzExpandChange)="unitSelectedIfy.tree.evtExpandChange($event)"
                    [nzExpandedKeys]="unitSelectedIfy.tree.nzExpandedKeys"
                    (nzCheckBoxChange)="unitSelectedIfy.tree.nzCheckBoxChange($event)"
                >
                    <ng-template #nzTreeRightTemplate let-node>
                        <span
                            class="custom-node"
                            [class.active]="unitSelectedIfy.tree.activedNode?.key === node.key"
                            (contextmenu)="
                                unitSelectedIfy.tree.contextMenu($event, contextTemplate, node)
                            "
                        >
                            <i
                                class="fa fa-{{
                                    unitSelectedIfy.tree.icons[node.origin?.nodeType]
                                }}"
                                aria-hidden="true"
                            ></i>
                            <span class="node-text" [attr.title]="node.title">{{
                                node.title
                            }}</span>
                            <span class="selected-level" *ngIf="node.origin?.includeChild"
                                >已选下层</span
                            >
                        </span>
                    </ng-template>

                    <ng-template #contextTemplate>
                        <ul nz-menu nzInDropDown>
                            <li nz-menu-item (click)="unitSelectedIfy.tree.evtChecklevel(true)">
                                选中下层
                            </li>
                            <li nz-menu-item (click)="unitSelectedIfy.tree.evtChecklevel(false)">
                                取消下层
                            </li>
                        </ul>
                    </ng-template>
                </nz-tree>
            </cdk-virtual-scroll-viewport>
        </div>
    </div>
</nz-drawer>
