<div class="layout level_rise">
    <!-- *ngIf="userInfo?.power" -->
    <div class="header">
        <button nz-button (click)="evtDeploy()">
            <i nz-icon nzType="select"></i>
            年度考核部署
        </button>
    </div>
    <div class="header year_list">
        <nz-select
            style="width: 120px"
            [(ngModel)]="operDeployIfy.year"
            (ngModelChange)="operDeployIfy.evtYearChange()"
            nzPlaceHolder="选择年份"
        >
            <ng-container *ngFor="let item of operDeployIfy.yearList">
                <nz-option [nzValue]="item" [nzLabel]="item"></nz-option>
            </ng-container>
        </nz-select>
    </div>

    <div class="container">
        <div class="view_scroll">
            <div class="deploy_tbl" *ngIf="userInfo?.power">
                <ng-template [ngTemplateOutlet]="deployTableElement"></ng-template>
            </div>
            <div class="audit_tbl">
                <ng-template [ngTemplateOutlet]="auditTableElement"></ng-template>
            </div>
        </div>
    </div>
</div>

<!-- 部署情况 -->
<ng-template #deployTableElement>
    <div class="layout">
        <div class="header subtitle">部署情况</div>
        <div class="container">
            <div class="view">
                <nz-table
                    #deployTable
                    nzBordered
                    nzSize="small"
                    [nzFrontPagination]="false"
                    [nzPageSize]="operDeployIfy.table.pageSize"
                    [nzPageIndex]="operDeployIfy.table.pageIndex"
                    [nzShowTotal]="operDeployIfy.table.total"
                    [nzData]="operDeployIfy.table.rows"
                >
                    <thead>
                        <tr>
                            <th>业务标题</th>
                            <th>办理年份</th>
                            <th>默认考核日期</th>
                            <th>截止考核时间</th>
                            <th>部署单位</th>
                            <th>已完成</th>
                            <th>未完成</th>
                            <th>未启动</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of deployTable.data">
                            <td>
                                <a (click)="operDeployIfy.evtEdit(data)">{{ data.ASSESS_TITLE }}</a>
                            </td>
                            <td>{{ data.ASSESS_YEAR }}</td>
                            <td>{{ data.ASSESS_DEFAULT_TIME | date: 'yyyy-MM-dd' }}</td>
                            <td>{{ data.ASSESS_DEADLINE }}</td>
                            <td>{{ data.unitName }}</td>
                            <td>{{ data.f }}</td>
                            <td>{{ data.n }}</td>
                            <td>{{ data.s }}</td>
                        </tr>
                    </tbody>
                </nz-table>
            </div>
        </div>
    </div>
</ng-template>

<!-- 业务审核 -->
<ng-template #auditTableElement>
    <div class="layout">
        <div class="header subtitle">业务办理</div>
        <div class="header">
            <nz-tabset
                [nzTabBarStyle]="{ 'margin.px': 0, 'height.px': 50, 'padding-top': '3px' }"
                [(nzSelectedIndex)]="jobStateTabsIfy.selectIndex"
                (nzSelectChange)="jobStateTabsIfy.evtTabsChange($event)"
                [nzTabBarExtraContent]="extraTemplate"
            >
                <nz-tab *ngFor="let tab of jobStateTabsIfy.list" [nzTitle]="tab.text"></nz-tab>
            </nz-tabset>

            <ng-template #extraTemplate>
                <nz-select
                    [ngStyle]="{ 'width.px': operSearchify.width || 200, margin: '6px 10px' }"
                    nzShowSearch
                    [nzPlaceHolder]="'请输入关键字搜索'"
                    [nzShowArrow]="false"
                    [(ngModel)]="operSearchify.value"
                    (ngModelChange)="operSearchify.evtChange($event)"
                    (nzOnSearch)="operSearchify.evtOnSearch($event)"
                    (nzOpenChange)="operSearchify.evtOpenChange($event)"
                >
                    <nz-option
                        *ngFor="let o of operSearchify.list"
                        [nzLabel]="o.text"
                        [nzValue]="o.value"
                    >
                    </nz-option>
                </nz-select>
            </ng-template>
        </div>
        <div class="container">
            <div class="view">
                <nz-table
                    #operTableElement
                    nzBordered
                    nzSize="small"
                    [nzFrontPagination]="false"
                    [nzData]="operTableIfy.data"
                    [nzTotal]="operTableIfy.totalCount"
                    [(nzPageIndex)]="operTableIfy.pageIndex"
                    [(nzPageSize)]="operTableIfy.pageSize"
                    (nzPageIndexChange)="operTableIfy.evtPageChange()"
                    (nzPageSizeChange)="operTableIfy.evtPageChange(true)"
                    [nzLoading]="operTableIfy.loading"
                    [nzShowSizeChanger]="true"
                    [nzShowTotal]="totalTemplate"
                >
                    <thead>
                        <tr>
                            <th nzWidth="180px">标题</th>
                            <th nzWidth="220px">考核年份</th>
                            <th nzWidth="500px">截止考核时间</th>
                            <th nzWidth="180px">默认考核时间</th>
                            <!-- <th nzWidth="120px">操作</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let item of operTableElement.data; let i = index">
                            <tr
                                [class.active]="operTableIfy.selectedRowIndex === i"
                                (click)="operTableIfy.evtSelectorRow(i)"
                            >
                                <td
                                    style="color: #1890ff; cursor: pointer"
                                    (click)="operTableIfy.evtRedirectRoute(item)"
                                >
                                    {{ item.ASSESS_TITLE }}
                                </td>
                                <td>{{ item.ASSESS_YEAR }}</td>
                                <td>{{ item.ASSESS_DEADLINE | date: 'yyyy-MM-dd' }}</td>
                                <td>{{ item.ASSESS_DEFAULT_TIME | date: 'yyyy-MM-dd' }}</td>
                            </tr>
                        </ng-container>
                    </tbody>
                </nz-table>
                <ng-template #totalTemplate> 总共：{{ operTableIfy.totalCount }}条</ng-template>
            </div>
        </div>
    </div>
</ng-template>
