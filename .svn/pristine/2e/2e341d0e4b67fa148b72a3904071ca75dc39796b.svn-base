<div class="layout">
    <div class="header">
        <div class="view">
            <nz-tabset
                [(nzSelectedIndex)]="headerTabIfy.selectedIndex"
                [nzTabBarStyle]="{ 'margin.px': 0, 'height.px': 50 }"
                (nzSelectChange)="headerTabIfy.change()"
            >
                <nz-tab nzTitle="日程"> </nz-tab>
                <nz-tab nzTitle="待办理"> </nz-tab>
            </nz-tabset>
        </div>
    </div>
    <div class="container" *ngIf="headerTabIfy.selectedIndex === 0">
        <!-- <div class="left">
            <div class="view">
                <div class="date_time">
                    <nz-calendar
                        [nzFullscreen]="false"
                        [(ngModel)]="scheduleIfy.date"
                        (nzSelectChange)="scheduleIfy.selectChange($event)"
                    ></nz-calendar>
                </div>
            </div>
        </div> -->
        <div class="right">
            <div class="view full_calender">
                <full-calendar #scheduleElement [options]="calendarOptions"></full-calendar>
            </div>
        </div>
    </div>
    <div class="container" [hidden]="!(headerTabIfy.selectedIndex === 1)">
        <div class="layout">
            <div class="header">
                <nz-tabset
                    [nzTabBarStyle]="{ 'margin.px': 0, 'height.px': 50 }"
                    (nzSelectChange)="workbenchfy.tabs.change($event)"
                    [(nzSelectedIndex)]="workbenchfy.tabs.selectedIndex"
                >
                    <ng-container *ngFor="let item of workbenchfy.tabs.list">
                        <nz-tab [nzTitle]="item.text"></nz-tab>
                    </ng-container>
                </nz-tabset>
            </div>

            <div class="container">
                <div class="view_scroll oper_table">
                    <nz-table
                        #basicTable
                        nzShowSizeChanger
                        nzBordered
                        nzSize="small"
                        [nzFrontPagination]="false"
                        [nzTotal]="workbenchfy.operTable.totalCount"
                        [(nzPageSize)]="workbenchfy.operTable.pageSize"
                        [(nzPageIndex)]="workbenchfy.operTable.pageIndex"
                        [nzPageSizeOptions]="[5, 10, 20, 50]"
                        [nzData]="workbenchfy.operTable.data"
                        (nzPageIndexChange)="workbenchfy.operTable.loadPage()"
                        (nzPageSizeChange)="workbenchfy.operTable.loadPage()"
                    >
                        <thead>
                            <tr>
                                <th>业务状态</th>
                                <th>业务名称</th>
                                <th>业务标题</th>
                                <th>业务步骤</th>
                                <th>办理人</th>
                                <th>业务跟踪</th>
                                <th>发起时间</th>
                                <th>发起单位</th>
                                <!-- <th>操作</th> -->
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of basicTable.data">
                                <td>
                                    {{
                                        workbenchfy.tabs.selectedIndex === 2 ||
                                        workbenchfy.tabs.selectedIndex === 3
                                            ? jobMainState_CN[data.jobMainState].text
                                            : jobStepState_CN[data.jobStepState]
                                    }}
                                </td>
                                <td>{{ data.wfName }}</td>
                                <td>
                                    <a (click)="workbenchfy.operTable.navigate(data)">{{
                                        data.title
                                    }}</a>
                                </td>
                                <td>
                                    <a (click)="workFlowChartParam.open(data)">{{
                                        data.lastStepName
                                    }}</a>
                                </td>
                                <td>{{ data.userName }}</td>
                                <td>
                                    <a (click)="tailAfterOper.open(data)">查看</a>
                                </td>
                                <td>{{ data.startTime | date: 'yyyy-MM-dd' }}</td>
                                <td>{{ data.startOrgName }}</td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 业务跟踪 -->
<nz-drawer
    [nzClosable]="true"
    [nzWidth]="tailAfterOper.width"
    [nzVisible]="tailAfterOper.visible"
    nzPlacement="right"
    [nzTitle]="tailAfterOper.title"
    (nzOnClose)="tailAfterOper.close()"
>
    <div class="drawer_area">
        <div class="container">
            <nz-timeline>
                <nz-timeline-item [nzDot]="dotTemplate"><span>业务开始</span></nz-timeline-item>
                <ng-container *ngFor="let item of tailAfterList$; let i = index">
                    <nz-timeline-item [nzColor]="['red', 'blue', 'green'][i % 3]">
                        <p>
                            <!-- <a (click)="viewHistory(item)">{{ item.stateDesc }}</a> -->
                            <a>{{ item.stateDesc }}</a>
                            {{ item.auditDate | date: 'yyyy-MM-dd HH:mm' }}
                        </p>
                        <p>
                            <b
                                ><span>{{ item.contacts }}</span></b
                            ><span> {{ item.orgName }} {{ item.contactNumber }}</span>
                        </p>
                        <p *ngIf="item.auditStateDesc">批复结果： {{ item.auditStateDesc }}</p>
                    </nz-timeline-item>
                </ng-container>
            </nz-timeline>
            <ng-template #dotTemplate>
                <i nz-icon type="clock-circle-o" style="font-size: 16px"></i>
            </ng-template>
        </div>
    </div>
</nz-drawer>
<nz-drawer
    [nzClosable]="true"
    [nzVisible]="workFlowChartParam.visible"
    nzPlacement="top"
    nzTitle="流程图"
    (nzOnClose)="workFlowChartParam.close()"
>
    <div style="margin-top: 20px">
        <nz-steps [nzCurrent]="workFlowChartParam.currentStep" nzProgressDot>
            <nz-step
                *ngFor="let item of workFlowChartParam.operStepList"
                [nzTitle]="item.stepName"
                [nzDescription]="item['desc']"
            >
            </nz-step>
        </nz-steps>
    </div>
</nz-drawer>
